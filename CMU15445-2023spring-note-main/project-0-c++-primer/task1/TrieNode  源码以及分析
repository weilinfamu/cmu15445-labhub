// A TrieNodeWithValue is a TrieNode that also has a value of type T associated with it.
template <class T>
class TrieNodeWithValue : public TrieNode {
 public:
  // Create a trie node with no children and a value.
  explicit TrieNodeWithValue(std::shared_ptr<T> value) : value_(std::move(value)) { this->is_value_node_ = true; }

  // Create a trie node with children and a value.
  TrieNodeWithValue(std::map<char, std::shared_ptr<const TrieNode>> children, std::shared_ptr<T> value)
      : TrieNode(std::move(children)), value_(std::move(value)) {
    this->is_value_node_ = true;
  }

  // Override the Clone method to also clone the value.
  //
  // Note: if you want to convert `unique_ptr` into `shared_ptr`, you can use `std::shared_ptr<T>(std::move(ptr))`.
  auto Clone() const -> std::unique_ptr<TrieNode> override {
    return std::make_unique<TrieNodeWithValue<T>>(children_, value_);
  }

  // The value associated with this trie node.
  std::shared_ptr<T> value_;
};
-------------------------------------------------------------------------------------------------------------------
æ ¸å¿ƒè®¾è®¡æ„å›¾
è¿™ä¸ªTrieNodeç±»çš„è®¾è®¡ç›®æ ‡æ˜¯:

æ”¯æŒä¸å¯å˜(immutable)æ•°æ®ç»“æ„
å®ç°å†™æ—¶å¤åˆ¶(copy-on-write)ä¼˜åŒ–
ä½œä¸ºå¯èƒ½å­˜å‚¨å€¼çš„èŠ‚ç‚¹çš„åŸºç±»
--------------------------------------------------------------

ä¸»è¦ç»„ä»¶è§£æ
1. å­èŠ‚ç‚¹å­˜å‚¨

âœ… åŸå§‹å£°æ˜å¤ä¹ ä¸€ä¸‹ï¼š

std::map<char, std::shared_ptr<const TrieNode>> children_;
ğŸ” æ‹†æˆå››ä¸ªéƒ¨åˆ†æ¥è®²è§£ï¼š
éƒ¨åˆ†	å«ä¹‰
std::map<char, ...>	ä¸€ä¸ªæ˜ å°„ç»“æ„ï¼Œkey æ˜¯å­—ç¬¦ï¼ˆcharï¼‰ï¼Œè¡¨ç¤ºä¸€å±‚ Trie çš„åˆ†æ”¯
std::shared_ptr<...>	æ¯ä¸ªå­—ç¬¦å¯¹åº”ä¸€ä¸ªå…±äº«æ™ºèƒ½æŒ‡é’ˆ
const TrieNode	æŒ‡å‘ä¸€ä¸ª ä¸å¯ä¿®æ”¹çš„ TrieNode å¯¹è±¡
children_	æˆå‘˜å˜é‡åï¼Œä»£è¡¨â€œå­èŠ‚ç‚¹é›†åˆâ€


------------------------------------------------------------------------------------------------------------------------------------------

ä»€ä¹ˆæ˜¯ std::shared_ptr<const TrieNode>ï¼Ÿ
æˆ‘ä»¬æ¥ä»å†…å‘å¤–è¯»ï¼š

â€œä¸€ä¸ªæŒ‡å‘ const TrieNode çš„æ™ºèƒ½æŒ‡é’ˆï¼Œæ”¯æŒå¤šä¸ªåœ°æ–¹å…±äº«å¼•ç”¨ã€‚â€
------------------------------------------------------------------------------------------------------------------------------------------
æ³¨æ„ï¼š

å®ƒæ˜¯ä¸€ä¸ªç±»å®ä¾‹æ²¡é”™ï¼ˆå°±æ˜¯ TrieNode å¯¹è±¡ï¼‰
åŠ äº† constï¼Œæ„æ€æ˜¯ï¼šé€šè¿‡è¿™ä¸ª shared_ptrï¼Œä½ åªèƒ½è¯»ï¼Œä¸èƒ½æ”¹

------------------------------------------------------------------------------------------------------------------------------------------
â— æ³¨æ„è¿™ä¸ª const ä¸æ˜¯ shared_ptr æœ¬èº«æ˜¯ constï¼
ğŸ‘‡ ä¸‹é¢å¯¹æ¯”ä¸€ä¸‹ä½ å°±æ‡‚äº†ï¼š

âœ… å½“å‰å®šä¹‰ï¼š

std::shared_ptr<const TrieNode> p;
âœ… å¯ä»¥ä¿®æ”¹ pï¼ˆæŒ‡é’ˆå˜é‡æœ¬èº«å¯èµ‹æ–°å€¼ï¼‰

âŒ ä¸èƒ½é€šè¿‡ p å»æ”¹ *p æŒ‡å‘çš„ TrieNode

âŒ å¦‚æœå†™æˆè¿™æ ·ï¼š

const std::shared_ptr<TrieNode> p;
âŒ p è‡ªå·±æ˜¯å¸¸é‡ï¼Œä¸èƒ½èµ‹æ–°æŒ‡é’ˆ

âœ… ä½ å¯ä»¥æ”¹ *p æŒ‡å‘çš„ TrieNodeï¼ˆæŒ‡é’ˆèƒ½æ”¹å†…å®¹ï¼‰
------------------------------------------------------------------------------------------------------------------------------------------
ğŸ“Œ åŸå› ï¼šæ”¯æŒæŒä¹…åŒ–ä¸å¯å˜æ•°æ®ç»“æ„ï¼ˆPersistent Trieï¼‰
ä½ ä¸Šä¼ çš„ Trie å®ç°æœ‰ä¸ªæ ¸å¿ƒç‰¹ç‚¹ï¼šä¸å¯å˜ï¼ˆimmutableï¼‰è®¾è®¡ã€‚

åŠ ä¸Š const TrieNode æœ‰å‡ ä¸ªå¥½å¤„ï¼š

ä¼˜ç‚¹	è§£é‡Š
âœ… å¼ºåˆ¶ä¸å¯æ”¹	ä¿è¯ä½ ä¸èƒ½ä¿®æ”¹æ—§çš„èŠ‚ç‚¹ï¼ˆå®‰å…¨ï¼‰
âœ… æ”¯æŒç»“æ„å…±äº«	æ–°ç‰ˆæœ¬ Trie å¤ç”¨æ—§èŠ‚ç‚¹ï¼Œä¸éœ€è¦æ·±å¤åˆ¶
âœ… é¿å…è¯¯æ“ä½œ	ç¼–è¯‘å™¨è‡ªåŠ¨æŠ¥é”™ï¼šä½ ä¸èƒ½é€šè¿‡æ—§æŒ‡é’ˆä¿®æ”¹
âœ… é¿å…çº¿ç¨‹ç«äº‰	constå¯¹è±¡æ›´å®¹æ˜“åœ¨å¤šçº¿ç¨‹ä¸‹å…±äº«ä½¿ç”¨

----------------------------------------------------------------
virtual auto Clone() const -> std::unique_ptr<TrieNode> {
  return std::make_unique<TrieNode>(children_);
}
ğŸ‘·â€â™‚ï¸ã€Œåˆ›å»ºå¹¶è¿”å›å½“å‰èŠ‚ç‚¹çš„ä¸€ä¸ª æ·±æ‹·è´ï¼ˆå¤åˆ¶å“ï¼‰ï¼Œå¹¶æŠŠå®ƒåŒ…è£…åœ¨æ™ºèƒ½æŒ‡é’ˆé‡Œï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ã€
----------------------------------------------------------------------------------
âœ… virtual
è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè™šå‡½æ•°ã€‚
å®ƒå¯ä»¥è¢«æ´¾ç”Ÿç±»ï¼ˆå­ç±»ï¼‰é‡å†™ overrideã€‚
åœ¨è¿è¡Œæ—¶è°ƒç”¨çš„æ˜¯å®é™…å¯¹è±¡çš„ç‰ˆæœ¬ï¼ˆæ”¯æŒå¤šæ€ï¼‰ã€‚
TrieNode æ˜¯åŸºç±»ï¼›æœ‰äº›å­ç±»ï¼ˆæ¯”å¦‚ TrieNodeWithValue<T>) å¯èƒ½éœ€è¦é¢å¤–å¤åˆ¶ value_ï¼Œæ‰€ä»¥éœ€è¦â€œè‡ªå·±å®ç° cloneâ€ã€‚
----------------------------------------------------------------------------------------------------------------------------------------------------------------

auto Clone() const
æ‹†è§£ï¼š
auto æ˜¯è¿”å›ç±»å‹ï¼Œé…åˆ -> åé¢çœ‹æ¸…çœŸæ­£è¿”å›å•¥ã€‚

Clone() æ˜¯å‡½æ•°åã€‚

const è¡¨ç¤ºï¼šè¿™ä¸ªå‡½æ•°ä¸ä¼šä¿®æ”¹å¯¹è±¡æœ¬èº«ï¼Œé€‚åˆåšâ€œåªè¯»å‹â€æ“ä½œï¼Œæ¯”å¦‚å…‹éš†ã€‚

-> std::unique_ptr<TrieNode>
è¿™æ˜¯å‡½æ•°çš„çœŸæ­£è¿”å›ç±»å‹ã€‚
è¡¨ç¤ºè¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªç‹¬å æ‰€æœ‰æƒçš„æ™ºèƒ½æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªæ–°çš„ TrieNode å¯¹è±¡ã€‚
---------------------------------------------------------------------------------------------------------------
è°ƒç”¨ std::make_unique<TrieNode>(children_)ï¼š
ç”¨ç°æœ‰çš„ children_ åˆ›å»ºä¸€ä¸ªæ–°çš„ TrieNodeã€‚
å°±åƒã€Œå¤åˆ¶äº†ä¸€æ£µæ ‘çš„æŸä¸€å±‚ã€ã€‚
è¿™ä¸ªæ–°å»ºå¯¹è±¡ç”± unique_ptr ç®¡ç†ï¼Œä¸éœ€è¦ä½ æ‰‹åŠ¨ deleteï¼Œè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼Œé˜²æ­¢æ³„æ¼ã€‚
---------------------------------------------------------------------------------------------------------------


