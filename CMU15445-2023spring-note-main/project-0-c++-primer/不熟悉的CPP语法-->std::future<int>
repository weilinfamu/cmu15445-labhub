ä¸ç†Ÿæ‚‰çš„CPPè¯­æ³•ï¼š
1ï¼š
â€œ
 std::future<int>
è¿™æ˜¯C++11å¼•å…¥çš„ä¸€ä¸ªæ ‡å‡†åº“ç±»å‹
ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœªæ¥ç»“æœ
ç›¸å½“äºä¸€ä¸ª"æ‰¿è¯º"ï¼Œè¡¨ç¤ºæŸä¸ªå€¼å°†åœ¨æœªæ¥æŸä¸ªæ—¶é—´ç‚¹å¯ç”¨
é€šå¸¸ä¸std::promiseã€std::asyncç­‰ä¸€èµ·ä½¿ç”¨æ¥å¤„ç†å¼‚æ­¥ç¼–ç¨‹
<int>è¡¨ç¤ºè¿™ä¸ªfutureæœ€ç»ˆä¼šæä¾›ä¸€ä¸ªæ•´æ•°ç±»å‹çš„ç»“æœ
â€

ä½ å¯ä»¥æŠŠ std::future<int> ç†è§£ä¸ºï¼š
ğŸ•“ â€œæœªæ¥æŸä¸ªæ—¶åˆ»æˆ‘ä¼šç»™ä½ ä¸€ä¸ªæ•´æ•°ï¼Œåªä¸è¿‡ç°åœ¨æˆ‘è¿˜æ²¡ç®—å®Œã€‚â€

å®ƒä¸€èˆ¬æœ‰ä¸‰ç§é…åˆæ–¹å¼ä½¿ç”¨ï¼š

ğŸ” å¸¸è§æ­é…æ–¹å¼
std::asyncï¼šä½ æ´¾ä¸€ä¸ªçº¿ç¨‹å»å¹²æ´»ï¼Œè¿”å› std::future<T>ã€‚

std::promiseï¼šä½ æ‰‹åŠ¨å†™ä¸€ä¸ªâ€œæ‰¿è¯ºâ€ï¼ŒæŸä¸ªåœ°æ–¹ set ä¸€ä¸ªå€¼ã€‚

std::packaged_taskï¼šä½ åŒ…è£…ä¸€ä¸ªå‡½æ•°ï¼Œå¼‚æ­¥æ‰§è¡Œè¿”å›ç»“æœã€‚

æˆ‘ä»¬ä»Šå¤©é‡ç‚¹çœ‹ std::async + std::future<int> çš„ç»„åˆï¼Œæœ€é€‚åˆåˆå­¦è€…ã€‚


âœ… ç¤ºä¾‹ä»£ç è®²è§£ï¼šä½¿ç”¨ std::future<int> è·å–å¼‚æ­¥ç»“æœ
æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªå‡½æ•° computeSquareï¼Œå®ƒè¦è®¡ç®—å¹³æ–¹ï¼Œä½†æ¯”è¾ƒæ…¢ï¼ˆæ¯”å¦‚ç¡1ç§’ï¼‰ã€‚æˆ‘ä»¬ç”¨ std::async å¯åŠ¨å®ƒï¼Œå¹¶ç”¨ future<int> è·å–ç»“æœã€‚

> futureResult = std::async(std::launch::async, computeSquare, 6);
std::async(...)
å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼ŒæŠŠ computeSquare(6) ä¸¢ç»™åå°çº¿ç¨‹å»è·‘ã€‚

std::launch::async
æ˜ç¡®è¡¨ç¤ºè¦åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚

std::future<int>
å£°æ˜ future å¯¹è±¡ï¼Œä»£è¡¨â€œå°†æ¥ä¼šæœ‰ä¸€ä¸ª int ç»“æœâ€ã€‚

futureResult
ä¿å­˜è¿™ä¸ª futureï¼Œå½“ä½  .get() å®ƒçš„æ—¶å€™ï¼Œå°±èƒ½å¾—åˆ°çœŸæ­£ç»“æœã€‚

âœ… é—®é¢˜ 1ï¼šstd::this_thread::sleep_for(...) æ˜¯ä»€ä¹ˆåº“çš„ï¼Ÿ
è¿™æ˜¯ C++11 æ–°å¢çš„æ ‡å‡†åº“å‡½æ•°ï¼Œå±äºä¸¤ä¸ªå‘½åç©ºé—´ç»„åˆï¼š

cpp
Copy
Edit
#include <thread>   // std::this_thread
#include <chrono>   // std::chrono::seconds
æ‰€ä»¥ä½ çš„ä»£ç åº”è¯¥åŠ ä¸Š #include <thread>ï¼Œå¦åˆ™æœ‰äº›ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚

âœ… å«ä¹‰æ‹†è§£ï¼š
std::this_thread::sleep_for(...) è¡¨ç¤ºï¼šå½“å‰è¿™ä¸ªçº¿ç¨‹æš‚åœæ‰§è¡Œä¸€æ®µæ—¶é—´

std::chrono::seconds(1) æ˜¯ä¸€ä¸ªç±»å‹å®‰å…¨çš„â€œ1ç§’æ—¶é—´æ®µâ€

ğŸ‘‰ å®ƒä»¬ç»„åˆçš„æ„æ€å°±æ˜¯ï¼š

å½“å‰çº¿ç¨‹ç¡ 1 ç§’ï¼Œæ¨¡æ‹Ÿâ€œæ…¢ä»»åŠ¡â€


#include <iostream>
#include <future>
#include <chrono>

// æ¨¡æ‹Ÿä¸€ä¸ªæ…¢å‡½æ•°ï¼Œè®¡ç®—å¹³æ–¹
int computeSquare(int x) {
std::this_thread::sleep_for(std::chrono::seconds(1))
return x*x;
}
int main(){
std::cout << "[ä¸»çº¿ç¨‹] å¼€å§‹æ‰§è¡Œ...\n";


return 0;
}


âœ… é—®é¢˜ 2ï¼šstd::launch::async çš„åº•å±‚æ˜¯å•¥ï¼Ÿæ˜¯ epoll å—ï¼Ÿ
ä¸æ˜¯ï¼è¿™éƒ¨åˆ† ä¸æ˜¯ epollï¼Œä¹Ÿä¸æ˜¯äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œè€Œæ˜¯ï¼š

ğŸ’¥ ç”¨çš„æ˜¯çº¿ç¨‹ï¼åº•å±‚æ˜¯é€šè¿‡åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡çš„ã€‚

ğŸ“Œ è¯¦ç»†è§£é‡Šï¼š
å½“ä½ å†™ï¼š

std::async(std::launch::async, some_function, args);
èƒŒåå¤§è‡´æµç¨‹æ˜¯ï¼š

C++ runtime ä¼šè°ƒç”¨ std::thread åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹

åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­è¿è¡Œ some_function(args...)

ä½ é€šè¿‡ std::future æ‹¿åˆ°è¿”å›å€¼

æ‰€ä»¥ std::async(..., std::launch::async, ...) ç­‰ä»·äºï¼š

cpp
Copy
Edit
std::thread t(some_function, args); // è‡ªåŠ¨å°è£…åˆ° future é‡Œ
è€Œ epoll æ˜¯æ“ä½œç³»ç»Ÿçš„ IOäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œç”¨äºç½‘ç»œ/æ–‡ä»¶IOçš„éé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œå’Œè¿™é‡Œçš„â€œè®¡ç®—å‹å¼‚æ­¥â€å®Œå…¨ä¸æ˜¯ä¸€å›äº‹ã€‚



